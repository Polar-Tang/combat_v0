local require = require(script.Parent.loader).load(script)
local BaseAbility = require("BaseAbility")
local HitboxModule = require("MuchachoHitbox")
local CooldownController = require("CooldownController")
local get_trail = require("get_trail")

local AttackBaseAbility = setmetatable({}, BaseAbility)
AttackBaseAbility.__index = AttackBaseAbility

type AttackBaseAbilityConfig = {
	name: string,
	cooldown: number?,
	damage: number,
	_maxCombo: number?,
	_serviceBag: any,
	character: Model,
	hitbox_size: Vector3,
	hitbox_offset: CFrame,
}

function AttackBaseAbility.new(config: AttackBaseAbilityConfig)

	local self = setmetatable(BaseAbility.new(), AttackBaseAbility)
	self.name = config.name
	self.cooldown = config.cooldown or 0
	self.damage = config.damage or 0
	self._cooldownController = CooldownController.new(config.character, config._serviceBag)
	self._lastSwing = 0
	self._serviceBag = config._serviceBag
	self._maxCombo = config._maxCombo
	self.character = config.character
	self.hitbox_size = config.hitbox_size
	self.hitbox_offset = config.hitbox_offset


	return self
end

function AttackBaseAbility:_createHitBox()
	print("Creating hitbox for ", self)
	local CHAR = self.character
	local hitbox_offset = self.hitbox_offset
	local hitbox_size = self.hitbox_size
	local HRP = CHAR:WaitForChild("HumanoidRootPart")
	local trail = get_trail(CHAR)
	local tool = CHAR:FindFirstChildWhichIsA("Tool")
	if tool and trail then
		trail.Enabled = false
	end
	local params = OverlapParams.new()
	params.FilterType = Enum.RaycastFilterType.Exclude

	local newHitbox = HitboxModule.CreateHitbox() --creating the hitbox
	newHitbox.Size = hitbox_size
	newHitbox.CFrame = HRP
	newHitbox.Offset = hitbox_offset
	newHitbox.OverlapParams = params
	newHitbox.AutoDestroy = false
	newHitbox.Puncher = CHAR
	return newHitbox
end

return AttackBaseAbility
